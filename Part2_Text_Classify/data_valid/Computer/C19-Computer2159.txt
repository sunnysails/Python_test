计算机应用研究
APPLICATION RESERCH OF COMPUTERS
2000  Vol.17　No.1　P.71-73




一种对胃窦B超图象进行自动分割的方法
张艳　费耀平　伍晓平　廖志宁　常小荣
摘 要 提出了一种对胃窦B超序列图象进行自动分割的方法。我们综合利用传统的图象分割技术，提出了一套自动提取胃窦初始轮廓的方法。在此基础之上，运用活动轮廓模型，进行边缘轮廓的逼近，从而获得比较精确的胃窦边缘轮廓。实验的结果证明了该方法的有效性。
关键词 图象分割 活动轮廓模型 胃窦 B超图象
1 引言
　　图象的分割是医学图象处理中的关键环节，本文所研究的胃窦分割问题是中医经络与肺腑相关研究课题阊裘骶胛赶喙毓媛傻难芯的重要组成部分。阊裘骶胛赶喙毓媛傻难芯是通过针刺足阳明经不同部位，来观察进针前后三分钟胃窦上下径、前后径以及面积的变化规律。
　　由于B超具有无损性的优点，而且操作简便，形象直观。在研究过程中采用了B超显像来观测胃窦的变化。从图象处理的角度来看，医学图象由于其信噪比低、运动模糊等特性，是图象分割中的一个难点。而B超图象是医学图象中质量最差的一种，与其它图象(显微镜成像、CT、MR等)相比，B超图象分割显得更为困难。目前，医学图象分割研究较多的是显微镜成像、CT(computed tomography)、MR(magnetic resonance)等，而对B超图象研究较少。同时，由于胃的舒张和收缩及其蠕动，使得胃窦是一个不规则运动的非刚性的物体，在一定程度上加大了边缘的模糊性，增大了分割的难度。对于胃窦B超图象的分割，还未见国内外有这方面的研究报道。
　　目前对于医学图象的分割，国内外一般是通过人工干预，采用半自动的方法来实现。本文对胃窦B超图象的分割进行了深入地研究，在活动轮廓模型(Active Contour Models)的基础上提出了一个从初始轮廓提取到精确轮廓逼近的完整的分割方案，该方法实现了自动分割，减少了分割时间，提高了分割的准确性。
　　本文结构安排：第二部分介绍初始轮廓的获取，第三部分介绍轮廓的优化，第四部分介绍采用本方法进行胃窦B超图象分割的结果，第五部分为结论部分。
2 初始轮廓的自动获取
应用活动轮廓模型进行分割，通常的做法是人工在真实边缘附近选择若干点，然后用直线或曲线将这些点连接起来，以此作为初始轮廓。在这里我们给出了一个自动提取胃窦初始轮廓的方案。
　　我们提出的初始轮廓的提取方法是一种基于灰度的方法。针对不同的图象质量，我们综合运用了二值化处理、形态学处理、多分辨率等图象处理方法，并提出了一个判定是否成功提取了初始轮廓的准则，利用该判定准则，将多种处理方法有机地结合起来，从而实现初始轮廓自动提取。
2.1 判定准则
根据胃窦本身的特点，其图象近似为一椭圆。我们采用如下两条规则作为判定准则。
f1=B>TB　　　　　　　　　　　　　　　　　　　 (1)
f2=C>TC 　　　　　　　　　　　　　　　　　　　(2)
　　其中B和C分别为轮廓跟踪所获得的轮廓的面积和圆度， TB和TC分别为根据经验值选取的面积和圆度的判定门限。如果(1)、(2)两式均成立，我们就认为初始轮廓提取成功。
2.2 二值化处理
　　从胃窦B超图象的整体来看，包含了两类对象物：器官组织(含肝尖、胃窦等)和背景。因此我们可以通过二值化处理来作初步分割。
　　二值化处理的阀值选择有两类方法：通过实验确定一固定阀值和自适应选择阀值。自适应方法中最常用的是双峰法，它要求灰度直方图有较明显的双峰。但B超图象质量较差，无法得到有明显双峰的直方图。这里我们利用大津阀值选择法实现阀值的自动选择。
　　大津阀值选择法是在判别与最小二乘法原理的基础上推导出来的。其基本原理是：把直方图在某一阀值处分割成两组，当被分割的两组间方差为最大时，取该灰度值为阀值。采用该方法对胃窦图象进行二值化处理，我们成功地将原始图象分成了器官组织与背景两部分。
　　进行二值化处理后，如果目标物(胃窦)已形成封闭区域，便可直接使用轮廓跟踪技术来分割目标物，获得初始轮廓。否则就需进行形态学或多分辨率分析。
2.3 数学形态学处理与多分辨率分析
　　对原始图象进行二值化处理后，有一部分图象的目标物并未封闭，对于缺口较小的，我们采用数学形态学(Mathematical Morphology)处理，这样可以使一些较小的缺口弥合，形成封闭轮廓。对于缺口较大的情况，则采用金字塔在较低的分辨率下处理。
　　数学形态学是一门建立在集论基础上的学科，是几何形态分析和描述的有力工具。形态学处理定义了两个基本操作：腐蚀(erosion)与膨胀(dilation)。膨胀是一个扩张的过程，这种变换使得目标肢体扩张，孔洞收缩。腐蚀是一种收缩的过程，该变换使得目标肢体收缩，孔洞扩张。通常腐蚀与膨胀是结合起来使用的。按照腐蚀与膨胀的先后顺序构成了开闭运算：开运算是先腐蚀后膨胀，闭运算是先膨胀后腐蚀。开运算使目标轮廓光滑，并可去掉毛刺和孤立点。闭运算则添平了目标内部的小沟、孔洞和裂缝。
　　我们使用形态学变换的目的是将胃窦与其它器官组织(如肝尖等)分开，使目标轮廓断裂的部分连接起来，因而采用了开运算。先对二值化图象进行腐蚀，使得胃窦轮廓有缩小的趋势，可以使胃窦轮廓封闭，然后进行膨胀操作，以尽量使其恢复到原始的轮廓。
　　金字塔是一种对输入信息逐层提炼的数据结构，通常逐层所提炼的信息为原图象的灰度，金字塔的各层就是对原图象降低分辨率而生成的，金字塔的层数越高，分辨率越低。金字塔具有一种“距离效应”，因此可以使得原始图象中目标区域不相连的部分在金字塔的高层连续。
　　我们将胃窦B超的二值化图象作为金字塔的输入图象，将目标区域视为1，背景区域视为0，采用与(AND)金字塔，2×2的窗口，则第k层象素与第k-1层象素之间的关系可表示为：
　　　　　　　　　　　　　　　(3)
　　使用该方法，我们成功地使原始图象中不封闭的目标区域在金字塔上层得以封闭。从而可以在金字塔的顶层用轮廓跟踪的方法获得目标区域的轮廓，再将金字塔顶层的轮廓映射到金字塔图象的底层即可。
2.4 B样条拟合
　　由于原始图象本身的质量极差，经过上述方法提取出的初始轮廓形状复杂。而胃窦本身的边缘是平滑的，为了平滑初始轮廓，我们采用了工程上常用的三次B样条曲线来拟合初始轮廓。
　　以上我们分别述叙了在初始轮廓提取阶段所采取的各种方法。在实际使用中，我们将其有机地结合起来，形成一个如图1所示的自动处理流程。
3 轮廓的优化
　　在得到胃窦的初始轮廓之后，我们使用活动轮廓模型(Active Contour Models)对初始轮廓进行优化，使其逼近真实轮廓。
　　活动轮廓模型又称为蛇行模型(Snakes)。在几何上可以将其描述为一个图象平面(x，y)上的参数化曲线：
r(s)=(x(s),y(s)) s∈[0,1] 　　　　　　　　　　　　　　　(4)
　　在实际的实现过称中，活动轮廓是由一组蛇点组成，每个蛇点用它在图象中的坐标(x，y)来表示，把这些蛇点用直线或曲线连接起来即构成了整个轮廓。这样，整个轮廓就可以只用这些蛇点来表示，而活动轮廓的变形也就通过蛇点的运动来完成。

图1　初始轮廓提取流程图
　　活动轮廓模型实质上是一个能量最小化模型，其变形过程就是活动轮廓在外部能量(模拟外力)和内能(内力)的作用下向物体边缘靠近的过程，外力推动活动轮廓向着物体边缘运动，而内力则保持活动轮廓的光滑性和拓扑性；到达平衡位置时(对应于能量最小)的活动轮廓收敛到所要检测的物体边缘。
　　活动轮廓模型的能量E(r)由内部能量Eint(r)和外部能量Eext(r)构成：
E(r)=Eint(r)+Eext(r)　　　　　　　　　　　　　　　(5)
　　内部能量用于保持轮廓的平滑性，而外部能量则用来将轮廓吸引到真实的轮廓边缘。
　　内部能量又由两部分构成：
Eint=αEmembrane+βEthin_plate 　　　　　　　　　　　　　　　(6)
　　其中，α，β为弹性参数， Emembrane为弹性能量，主要是用于抗拉伸，将其定义为：
　　　　　　　　　　　　　　　(7)
　　Ethin_plate为弯曲变形能量，主要用于抵抗活动轮廓的弯曲变形，将其定义为：
　　　　　　　　　　　　　　　(8)
　　外部能量定义为： 　　　　　　　　　　　　　　　　　　　　　　　　(9)
　　Eext (ri)为蛇点ri处的外部能量。由于在胃窦B超图象分割中，所要利用的胃窦边缘信息，我们将Eext (ri)定义为：　　　　　　　　　　　　　　　(10)
　　即先对图象进行中值滤波，以滤除噪音，然后用Sobel算子来提取边缘信息。
　　我们选取初始轮廓上均匀分布的点作为初始蛇点的位置，采用梯度下降法实现轮廓的变形。并采用固定迭代次数与能量变化量相结合的方法作为迭代终止条件。即，设定一个最大的迭代次数，如果两次迭代的能量变化小于给定门限，则终止迭代，否则迭代到最大迭代次数终止。轮廓逼近的算法可描述如下。
　　按(5)式计算初始轮廓的内部能量
　　按(9)式计算初始轮廓的外部能量
While 不满足终止条件 Do
　　for 每个蛇点 Do
　　　　利用梯度下降法计算蛇点的新位置
　　按(5)式计算轮廓的内部能量
　　按(9)式计算轮廓的外部能量
End
4 实验结果
　　我们采用上述方法进行了胃窦B超序列图象的分割，取得了满意的结果。如图2中所示，a1、b1分别为两个实验对象的一幅原始B超图象，a2、b2是自动提取出的初始轮廓，a3、b3分别为相应的经过轮廓逼近所获得的最终分割结果。
5 结论
　　我们利用传统的图象分割技术和近年来引起广泛研究兴趣的活动轮廓模型，对胃窦B超图象的分割进行了深入地研究。在活动轮廓模型的基础上提出了一个完整的从初始轮廓提取到精确轮廓逼近的完整的分割方法，它实现了胃窦轮廓的自动分割，无需人工干预。实验所用原始图象是使用国产B超仪获得的胃窦图象，采用本文所叙自动分割方法，其分辨率可达92%。在实际应用中，采用日产ALOKA-SSD-630B型超声显像仪，此时原始图象的质量有明显的提高，相应分割的分辨率也会有明显提高。该方法虽是针对胃窦图象的分割提出的，但同时对于目标轮廓光滑、边缘特性较差的类似的图象的分割亦有一定的指导意义。
国家攀登计划项目(98-211)资助
张艳（长沙铁道学院信息技术研究中心 长沙 410075）　
费耀平（长沙铁道学院信息技术研究中心 长沙 410075）
伍晓平（长沙铁道学院信息技术研究中心 长沙 410075）　
廖志宁（长沙铁道学院信息技术研究中心 长沙 410075）　
常小荣（长沙铁道学院信息技术研究中心 长沙 410075）
参考文献
1，M. Kass, A. Witkin, and D. Terzopoulos. Snakes: Active contour models. International Journal of Computer Vision, Volume 1, number 4, 1987, 321~331
2，Barbara Levienaise-Obadia and Andrew Gee. Adaptive Segmentation of Ultrasound Images. http://www.jaist.ac.jp
3，Kok Fung Lai. Deformable contour: Modeling, Extraction, Detection and Classification. http://iris.usc.edu
4，Tim McInerney, Demetri Terzopoulos. Deformable models in medical image analysis:a survey. Medical image Analysis, Volume 1, number 2, 91～108
5，王省富主编. 样条函数及其应用. 西北工业大学出版社, 1989
6，郑南宁. 计算机视觉与模式识别. 国防工业出版社, 1998
7，王积分, 张新荣. 计算机图象识别. 中国铁道出版社, 1998
8，夏利民, 谷士文, 沈新权. 基于模糊形变模型的3D表面自适应重建. 长沙铁道学院学报, 1999年, 第3期
9，夏利民, 谷士文, 沈新权. 基于活动轮廓的运动目标的动态分割. 中国图象图形学报, (已录用)
10，常小荣等. B超显像观察针刺足阳明经四肢段穴位对胃窦面积的影响, 湖南中医学院学报, 1997年第3期
收稿日期：1999年9月6日
