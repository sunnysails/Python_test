计算机应用研究
APPLICATION RESEARCH OF COMPUTERS
2000 Vol.17 No.3 P.85-86




基于LONWORKS技术的面向医院诊室的网络系统
王健琪　葛剑徽　杨波
摘　要：医院网络延伸至诊室一层，是提高网络使用价值的关键因素之一，讨论了基于LONWORKS技术的面向诊室网络系统的设计思想，给出了现场终端及电子处方系统的设计方案。
关键词：LONWORKS 医院诊室 网络单片机 电子处方
1　引言
　　网络技术在我国的医院中正在以一种前所未有的速度普及与应用，国内有一些较大规模医院组建了信息科及相关科室，开始了建立局域网(LAN)，开展了远程医疗网络系统的研究，以期综合利用各类卫生资源、提高医疗效率，但随着对信息的准确性与及时性要求的提高，目前已建成的医院网络已逐步暴露出一些问题。目前各医院网络主要覆盖各主要医疗科室和职能管理部门，基于条件和资金的限制，很少延伸到诊室一层。而诊室一层是医疗信息的原始来源层，目前许多信息是各诊室在相隔一段时间后收集、整理并统一人工录入的，尤其是有关药品使用和病人病历的信息，不是在第一时间内从诊室采集得来，从而导致信息上的滞后。例如门诊医生给病人开处方，如果信息及时进入网络，用药信息就能实时与药房药物库存信息对照，判断药房内是否有某类药物；与病人病历资料库相对照，判断病人对这些药是否有既往过敏史；与药物配合资料库相对照，判断这些药物是否能够混用。在进行一系列的对照判断后及时向医生处反馈信息。如果处方信息不能及时进入网络，就会造成药物的误用，还可能开出不适宜的药(造成过敏等反应)，同时，药房缺某类药而让病人在医生与药房间来回奔跑，使效率降低。再如，医生给病人开某项检查申请单，如果不能通过网络即时得到在相应时间段内做此项检查的人数的有关信息，就会造成单位时间段内单子总数过多，使病人等待检查的时间过长。
　　在当前医院网络系统结构下，因为实时采集信息的能力的欠缺，使得许多信息不具备时效性，不能直接、迅速、准确和及时地反应诊室病人的医疗信息，以供诊断、检查等参考。好比神经末梢不发达，不能及时感受外界信息并立即作出反应一样。因而本文提出建立面向诊室的网络系统。
2　面向诊室的网络系统
　　医院的网络系统平台使用一个扩展的局域网(Extented LAN)规模，使用以太(Ethernet)协议网络体系结构，网络体系可采用Netware、TCP/IP等，根据各院实际情况选用。医院可设一服务器或加上几个二级服务器，在每个科室至少设立一个主站站点，属于医院局域网的一级节点，它负责接收有关医疗信息，自动分类，将其存入相关数据库。另外将本科室日常诊断治疗方法、常用药品等一系列信息按一定的规范存入标准资料数据库，以供查询、比较、帮助及进行其它处理。
　　在每个诊室中建立多个小型终端(如图1所示)。门诊医生在工作过程中实时录入有关病历、处方等基本医疗信息，由诊室终端进行初步处理。初步处理包括：①显示；②打印；③将相关信息传送到科室主站；④接收处理反馈信息；⑤将一些消息经由本科室主站传送至诸如药房和CT室等检查单位的主站节点，并接收其反馈信息。

图1　面向诊室的网络系统结构
　　在主站中可将接收的有关信息，与医院各类资料库，如病历数据库、疾病处理分类数据库、药品配合疗效数据库等一系列标准数据库，以及检验中心和放射科的就诊预约病人登记库中的对应信息相比较，再将结果，如病人是否对处方药物有既往过敏史、当前某项检查的预约是否已满等信息数据反馈传送至诊室终端，帮助医生作出正确判断。
　　在相关病历、处方等医疗信息传送至主站时，可自动将其按规定的标准格式转换为数据库的记录，并向医院的同类的总数据库中添加。在科室主站中还可对本科各诊室汇集来的信息进行统计、报表、分析等处理。
　　上述的一系列数据库需要各医院根据自己的实际情况分类建立、规定统一的标准与格式，以利于信息的传输及转换。
　　诊室的小型终端只要求实现数据录入、显示、打印及一些并不复杂的计算处理等功能，强调的是造价低廉，不要求硬件高配置。使用PC机成本高，资源浪费，采用网络单片机(网络芯片)进行开发是一举两得的选择。
3　LONWORKS网络型单片机(芯片)
　　美国ECHELON公司的LONWORKS神经元网络单片机，其Neuron芯片是LONWORKS网络硬件应用当中的核心，而LONTALK协议是其网络通讯的关键。
　　网络型单片机Neuron 3150以单一芯片完成通讯和控制，并在芯片内部固化了通讯协议，极大地简化了计算机控制网络的硬件结构，多种通讯介质，方便的I/O形式，灵活的拓扑结构，本身具有运算处理和输入输出能力，能完成现场的计算处理工作，不需将信号完全传送给主机，直接完成现场控制过程。其主要特性如下：
　　(1)内部集成了三个CPU，两个用于网络处理中，另一个用于用户程序处理，突出了网络通讯的功能。
　　(2)十一个可编程输入输出管脚、两个16位定时器/计数器、十五个软件定时器，可直接使用软件定时器而不用考虑其具体操作。
　　(3)片内设有ROM、EPROM、RAM、多个外部扩展存储器接口、64K存储空间。
　　(4)五个网络通讯口线，三种网络通讯方式：单端、差分和特殊应用模式，最简便的方法为双绞线介质中的差分模式了。可达到1.25Mbps的通讯速率。
　　(5)LONTALK协议，Neuron芯片间的数据通讯，依靠固化在芯片内部的网络通讯协议。该网络通讯协议符合国际标准化组织(ISO)的开放系统互联协议(OSI)，即物理层、链接层、网络层、传送层、会议层、表示层和应用层这七层参考模型，在其最高层应用层上用了LONTALK协议提供的标准网络变量的功能。一般情况下，我们只需通过向标准网络变量赋值就可以完成网络通讯。依照不同的需要，网络变量的发送可以有四种方式，即确认、无确认、无确认重复和请求响应方式，权衡网络占用时间最少和信息收发的可靠性最高这一对矛盾来设立和选择这四种方式。 网络通讯协议以发送地址和接收地址为标识，LONTALK协议提供的标识节点方法有：域、子网、组、Neuron－ID四种。LONWORKS网络可有多种拓扑结构，如总线型、星型等。
4　诊室终端及电子处方
　　基于Neuron CPU 开发的诊室终端不仅完成网络终端的功能，而且可实现电子处方的功能。各类处方是医生和病人进行信息交换的最基本的医疗文件，也是医院最原始的医疗信息，这部分信息实现电子化，并进入网络，不仅能极大地发挥医院信息网的作用，而且减少了医生的劳动强度。

图2　Neuron芯片应用示意图
　　终端系统结构如图3，本系统以Neuron CPU为核心，由键盘、液晶显示器、微型打印机、网络通信管理、程序数据存储器等模块构成，它不但作为网络现场终端，而且作为电子处方生成器完成病人数据采集、显示、通用处方打印、自动划价、网络通信等功能，医生通过终端(电子处方)的中文界面生成处方，自动划价后打印，减少了病人划价的中间环节。终端通过双绞线接入医院信息网，全数字量传输，节约经费，可靠性高。经试用效果良好。

图3　诊室终端系统结构框图
王健琪(第四军医大学生物医学工程系 西安 710032)
葛剑徽(第四军医大学生物医学工程系 西安 710032)
杨波(第四军医大学生物医学工程系 西安 710032)
参考文献
1 张维勇, 陆 阳. 基于LONWORKS技术的智能控制器及其应用. 微型机与应用, 1998.1
2 莫卫东, 王 静, 孟大庆. NOVELL实用网络工程方法. 西安：西安电子科技大学出版社, 1997
收稿日期：1999年10月25日
