微型机与应用
MICROCOMPUTER & ITS APPLICATIONS
2000 Vol.19 No.2 P.22-25




企业系统备份的发展及可行的备份方案
李莉莉
摘 要： 分析了系统备份在国内企业的发展状况，给出了几种可行的实用备份方案，提出了国内企业将来可能采用的备份方式。
关键词： 系统备份 基于网络的备份 远程备份
1 系统备份在国内企业的发展
　　国内各企业从电子化开始所走过的备份之路，一般可以分成3个明显的阶段：
　　第一阶段，计算机应用刚刚开始，运作方法是“单机处理、软盘交流”，目的是减少实际工作的劳动强度，提高工作效率。那时计算机的工作量和业务处理的数据都不大，所以备份是随机的，由工作人员自己处理，其行为还无规范可言。
　　在随机备份中，操作系统和各类应用软件多用软盘备份，工作数据主要以热备份为主，在主机中另开分区进行备份，好一些的传到另一个系统中去备份，下班前再用软盘备份。虽然发生过一些问题，但对整个实际工作影响不大。总之，在这个阶段，备份没有得到足够的重视，完全是一种个人行为。
　　第二阶段，企业的计算机系统应用已经发展到以局域网为支撑的模式，企业内各部门的工作人员通过网络互相传递数据，网络已经成为整个业务活动中非常需要的一个部分，工作人员的工作与计算机系统及网络关系密切。
　　在这个阶段，各部门的工作人员和信息中心的工作人员都很重视数据备份，定期安全备份被提到了议事日程，备份成了每日数据加工必做的作业。于是，在总结备份工作经验教训的基础上，一些单位提出了面向灾害和灾难的备份设想，即在计算机系统和网络运行及企业运作发生意外的前期狠抓安全防范，在意外事故发生中重视各种应急措施，同时，正视和承认可能有冲破安全防范的意外事故发生，甚至有导致灾难的事故发生。因此，对业务数据仅有一般的热备份还不够，必须有针对灾难的冷备份。一般是在信息中心把全部运行数据下载，存入安全的存储媒介中，装入专用保险箱，由专人负责存放到比办公楼更安全的地方，为预防灾难再做最后一次备份，再准备一道防线。
　　第三阶段，计算机网络在企业得到进一步的发展，Intranet、Internet已经成为企业内的基础设施。各部门的工作人员都用上了基于网络的专用设计软件，他们在这类软件的支持下，在网上互相协作有时一个项目组的工作人员还可能远隔千里，网络已成为一刻也不能离开的基础设施。
　　在这个阶段，企业的安全运作和生产活动又给备份提出了更高的要求，除了要防范偶然的因素外，还要防范一些人为的因素如网络黑客。一些企业不约而同地产生了建立专职备份中心的方案。这个专职备份中心既要有对数据的完整冷备份，又要有系统和网络的热备份，双管齐下。在灾难发生之后，既要保证现有的工作数据不丢失、不错乱，又能马上替代现有主机系统和网络的正常运行和生产，确保整个业务工作不中断，为灾后迅速恢复原有的实际工作赢得时间和人力。
　　建立专职备份中心，首先要选择合适的地点，地处安全，而且数据通信条件要好，除了已有的线路外，还应准备1条可靠的大容量线路。对一些有野外实际工作的单位，如果条件许可，还可以配备大容量无线通信做备份。备份中心的规模要满足备份需求，还要经济合理，有利于发展。
　　就目前国内各企业的进展而言，多数企业正在或已经进入第二阶段，有少数企业正在进入第三阶段，只有极少数企业还处在第一阶段。
2 几种可行的实用备份方案
　　备份的方法有很多，这里根据国内企业的现状，介绍几个实用的基于网络的备份方案。
2．1 “独立办公室”内的系统备份方案
　　所谓“独立办公室”，是指拥有几台电脑的完全独立的办公室一些家庭及“微型公司”的内部结构也与此相同。这种单位的网络结构，也许只是几台PC的点对点的简单连接，但也有可能是单一服务器的主从式结构。对于这种单位，其备份工作有其独特的方式。
　　1．备份公用资料夹
　　在点对点的网络结构中，每台电脑由网卡、网线与集线器彼此连接，大家可以分享彼此的数据、打印机、传真机等，使每一个人都可以使用小型办公室里的所有资源。因此在确定备份策略时，除了遵守一般的规则，备份个人必要的档案资料外，对一些放在公用资料夹中的资料，也要做必要的备份。
　　因为公用资料夹其实就是某台PC里的资料夹，由该电脑的使用者将资料夹设定为共享，让所有网上的连线使用者存取，因此备份的实际做法就很简单；只要记得备份公用资料夹即可。每个人自己电脑上的工作目录也设定为只读的共享方式，使负责备份的电脑可以通过网络读取资料进行备份工作，不必在每台电脑上都安装备份的软硬件。至于是否用Zip、MO、CD－R或其它硬盘做备份设备，可视需备份的数据量、时间与周期来决定。
　　2．主从式结构的网络备份
　　虽然只是小型办公室，但是安装1台Windows NT服务器，可以让您的网络运作更有效率、功能更完整。而如果把Windows NT Server与Windows 98搭配起来，还可以给您带来意想不到的方便。
　　用Windows NT Server 4．0的“网域使用者管理员”建立使用者后，选择它的“设定档”，可以让您设定使用者的文档路径以及主目录，例如\\Server\Users\logname，设好后，在Windows 98控制面板中的“使用者”启动多人设定，输入您登录Windows NT的名称，并将“个人化项目”全部选取，如此一来就会在C\WINDOWS\Profiles里建立同样名称的子目录，并将相关项目都复制到子目录里。
　　接下来当把Windows 98重新启动、登录服务器时，会将C\WINDOWS\Profiles\logname上载到\\Server\Users\logname，此后，服务器端的资料夹就与您的个人电脑同步，在登录、退出时都会比较资料，使您的资料可以在服务器端备份。您可以直接利用NT Server内建的备份工具，将这些资料再做1份备份，储存在磁带机里，因此对于“独立办公室”或小型企业而言，有1套简单的Client／Server网络结构，会使得资料的储存与备份更安全、更方便。
　　3．备份Windows应用系统
　　重装Windows和必要的应用系统，可能要用上2～3小时，如果10分钟就可以完成这项工作，那么3台、5台电脑的恢复工作就可以节省一整天的时间，这对时间紧张的现代人来说，是一份不小的收益。
　　PowerQuest的DriveImage与Norton的Ghost，都能帮助将整个硬盘备份成1个映像，在系统被严重破坏时，就可以很快把资料完全复原。因此可以将刚安装好应用程序的系统做1个备份的映像，以后安装系统只要10分钟就可以完成，再配合每周、每月备份的个人资料，您就可以拥有一个安全、快速的作业环境。DriveImage的操作界面友善、使用方便。Ghost有批操作模式，功能强大，二者各有其长。
2．2 跨平台备份
　　在当前稍具规模的企业网络中，因为工作性质复杂，不少单位都采用了多个工作平台。对这类系统的备份，必须考虑其特别的需求。
　　过去，一般备份软件或是应用系统内含的备份功能，仅能针对单机或是同一工作平台主机进行备份，并且采用Pull的方式备份，对于跨平台的备份则无能为力。为解决此问题，并提高备份效率，可采用Push技术的新概念。利用各种平台的客户端代理程序与备份主机的协同作业，将所需的资料Push到备份主机上，以节省作业时间，提高备份效率，并达到集中式管理的目标。
　　所谓的Push技术就是当网络管理员对备份主机下达备份指令时，备份主机即对所有客户端代理程序下达资料打包的命令，客户端收到命令后，自动针对备份主机所要求的备份数据进行过滤，并将过滤后的数据及目录封包好。当所有客户端同时进行过滤封包作业并将资料准备完毕时，便自动将资料Push到备份主机。所有过滤及封包的操作都在客户端进行，通过分散式运算及批次传送的方式，可大幅减少主机及网络负载。
　　在这方面，目前已有一些可供选择的备份软件，如CA公司的跨平台数据备份管理软件ARCserve。通过使用ARCserve for Windows NT和其数据库代理选件Database Agent，还可以在不用关闭数据库的情况下联机备份。在ARCserve软件中还有1种灾难恢复选件Disaster Recovery for ARCserve for Windows NT。Disaster Recovery灾难恢复选件可以让您生成4张（或5张）自引导软盘，一旦系统完全崩溃，您可以利用这几张自引导软盘加上最新做的1次完全备份的磁带，就可以在很短的时间内将整个系统全部恢复出来。
2．3 SQL数据库的备份
　　不少单位都使用基于SQL的数据库做自身的中心数据库，而SQL数据库又与传统数据库有很大区别。因此，这就需要专为SQL数据库所设计的备份代理程序。在这方面可供选择的产品非常有限，在市面上能见到有Microsoft SQL Server 7．0所提供的备份选件。
　　数据库备份代理程序的工作方式，是利用代理程序做备份软件与SQL Server间的中介程序，当备份软件下达备份指令之后，代理程序即对SQL Server做系统备份要求，指示SQL Server准备备份的数据。事实上就是对SQL Server下达Dump指令，其它备份参数也通过代理程序的设定，一并送至SQL Server，系统管理员完全不需下达任何SQL Command或Store Procedure。
　　SQL Server接到指令后，从SQL数据库提取系统要求的数据，并将其封包送至代理程序，再由代理程序将资料送至备份软件写入磁带中。而备份代理程序也利用备份软件的图形化界面，提供以下功能，让系统管理人员的备份操作更容易。
　　1．远端管理
　　如果服务器位于远端，只要在需备份的SQL服务器中安装代理程序，备份软件即可通过中央控制台统一监控、管理、备份及恢复所有的SQL服务器，完成所需工作。
　　2．仅备份及恢复必要的表格
　　数据库备份代理程序提供的备份软件在备份资料的设定上，可针对任何一个单一数据表进行备份，并且完全通过图形界面选择，不需下达指令。恢复时，代理程序亦可针对单一数据表进行恢复，不必因为一张数据表被毁即需恢复整个数据库。
　　3．Data Striping功能
　　通过代理程序多进程的处理能力，能将数台SQL服务器及不同配置读入其数据表，以Data Striping的方式写入同一卷磁带中。 
　　4．同时备份多个数据库至多个磁带
　　数据库备份代理程序不仅可将不同来源的SQL数据库资料写入同一卷磁带，也可将不同来源的数据同时写入多卷磁带中。这对于使用磁带柜来统一管理备份资料的单位来说，系统管理人员可将不同部门、不同来源的不同数据表，写入各部门所属的磁带中，这样可方便地将各部门资料分门别类地存放，节省日后恢复时所需耗费的时间。
　　5．统一安排，备份作业同时启动
　　通过备份软件的计划功能，可为整个企业包括SQL Server建立一个完善的备份计划及策略，并可借助备份时的呼叫功能，让所有的SQL服务器备份都能在同一时间进行。不必再辛苦地利用Dump到硬盘再备份的方式来进行备份作业，这样可减少管理上的负担。
　　6．恢复时自动建立所需的数据库配置及交易记录装置
　　当SQL Server被毁重建时，最让系统管理人员头痛的，就是将被毁前SQL Server的配置一一手动复原。如果操作有错，在资料恢复时即会造成错误。如果通过代理程序的协助，备份软件在恢复SQL数据库时，就会自动建立所需的数据库配置及交易记录装置，这就使得过去头痛的事完全让机器代理了。
　　7．恢复时可选择不同的服务器及不同的数据库名称
　　要将已备份的资料恢复到SQL Server中，一般来说服务器名称及数据库名称都需与原来备份时相同，但数据库备份代理程序可将资料恢复到不同服务器及数据库，即使名称完全不同亦可恢复。
　　8．在线即时恢复
　　通过备份代理程序，可在SQL Server启动时将资料在线上即时恢复入数据库中，完全不影响SQL Server的正常运作，SQL Server服务亦不需停止。
2．4 分级式存储管理
　　现在很多单位的资料中都含有大量的多媒体信息，因此其容量极大，而且多数资料又需保持在线状态。这些与日俱增的电子资料，不断地侵蚀着昂贵的硬盘空间，但又不能移走这些资料，因为它们可能随时都要用到。较好的办法是由MIS人员或是客户每日筛选出不常用的资料，备份到磁带或其它较便宜的介质上。但这项工作不论是由MIS人员或是用户来做，都会造成巨大的工作负担，影响正常工作的进行。
　　基于管理及成本的考虑，HSMHierarchical Storage Management，分级式存储管理系统是一个合适的在线备份解决方案。它利用硬盘、MO、碟带进行三级备份。所谓分级式存储管理系统，就是一套自动化的网络存储管理设备，能自动判断硬盘中资料的使用频率，自动将不常用的资料移至速度较慢的MO，而最不常用的资料则移到磁带中，这些都由系统管理员自行设定。在线的资料经过一段时间的搬移后，即可达到最佳化。
　　一般来说，资料被搬移至另一个存储介质后，HSM会在原存储介质上留下1个“存根”，对于客户端的使用者来说，当他们通过网络浏览磁盘目录时，这些存根看起来就和被移走的原始资料一样。当客户端针对这个存根进行存取时，分级式管理系统会将原始档案存回硬盘中，只是对于要搬移并执行存储在MO或磁带中的档案，在存取速度上要比硬盘慢些。
　　整个档案管理及存储搬移工作，都由分级式存储管理系统负责，不需手动操作，完全自动化。分级式存储管理系统的目的，在于节省整体系统存储装置的成本，利用成本较低的存储介质来存储不常用的资料，将最不常用的资料存储在最便宜的介质上。这样整个存储设备的平均成本将大幅降低，而把有限的预算花在购买足够的硬盘上，以存储最重要的资料。
　　分级式存储管理系统的另一个长处，是能利用自动化的资料移转功能，简化系统管理人员的维护工作。通过系统自动判别资料的使用状况，并移至其它存储介质，系统管理人员就不需要以手动方式自行判断及移动资料，将这些日常的机械性工作交给电脑自动执行，即可节省系统管理人员的大量时间，又可大量节省重点资料的备份时间。这种备份的时间越短，其因数据变动而产生的副作用就越小。
3 远程备份
　　随着基于网络的专用设计软件的广泛使用，以及实际工作中对网上协作依赖性的日益增强，以后必然会产生对“远程备份”的需求。而“远程备份”的方式，目前已有3种：硬盘异地镜像、数据库异地镜像及交易异地镜像。
　　硬盘异地镜像：通过保持分布在不同地方的2个或多个硬盘内容的一致来实现数据备份。镜像的对象是硬盘的处理单位，如数据块、扇区等。镜像方式有同步及异步方式。同步方式的速度较低，但数据一致性好；异步方式的速度较快，但数据一致性较差。对于异地备份来说，由于通信带宽的限制及对处理速度的考虑，一般采用异步方式。
　　数据库异地镜像：通过保持分布在不同地方的2个或多个数据库系统内容的一致性，来实现数据镜像。镜像的对象是数据库的处理单位，如事务日志逻辑日志。镜像方式也有同步与异步2种，在实时应用系统中，一般采用异步方式。
　　这2种方案均存在着一些待解决的问题，如网络传输延时大，通信带宽有限制，处理效率不理想等。为了解决上述问题，有人提出了对“交易”进行镜像的“交易异地镜像”备份方案。 
　　所谓“交易”，是指在实际工作中，1次通过网络协作应答的过程，或1次存盘动作。如工作人员A向另一专业的工作人员B提出：需要1个专业数据，B即向A提供了所需的数据。该过程就是一个“交易”；若1个工作人员画了几笔图后，发了1个把该图存盘的指令，这也是一个“交易”。
　　为了说明交易异地镜像的基本原理，假设：2个系统的初始数据状态一致，若双方按顺序执行一系列相同的数据操作，则双方的最终数据状态仍保持一致。在“基于网络的设计系统”的灾难备份系统中，只要保证备份系统和生产系统按顺序执行相同的数据操作，就可保证2个系统之间数据的一致性及完整性。
　　交易异地镜像的基本思想是：以交易为单位，将交易数据备份到备份系统中，通过备份系统中的应用系统执行这些交易，从而对数据库进行相同的操作，最终实现数据的一致性及完整性。
　　　交易异地镜像的实现中，主要要解决2个问题：1．将交易备份到备份系统，并通过应用程序的运行，实现对数据库相同的操作，保证数据的一致性；2．控制丢失“交易”对系统功能的影响，恢复丢失的“数据余量”。
　　从理论上说，这些远程备份方式都能够实现，也确有个别非企业单位通过复杂的配置实现了远程备份。但目前市场上还没有可供选择的现成产品，这些备份方式的实用化，还有一个待发展的过程，这是一个更为广阔的天地。
李莉莉（河北任丘市华北石油研究院开发试验机室062552）
收稿日期：1999－09－09
