微型机与应用
MICROCOMPUTER & ITS APPLICATIONS
1999年 第18卷 第2期 Vol.18 No.2 1999



计算机与PLC集成控制系统在石化行业的应用
陈　勇　张华平　赵显红
　　摘　要：计算机与PLC集成控制系统的基本组成、功能、系统软硬件设计与通信技术以及该系统在石化行业的应用。
　　关键词：计算机　PLC可编程序控制器　控制系统　通信技术
　　近年来，国际市场上石化产品的竞争日趋激烈。与国外同类产品相比，我国的石化产品无论在生产工艺上，还是产品质量上，都存在着相当大的差距。为改变我国石化产品发展严重滞后的局面，国内石化行业的许多厂家已开始向产品的多样化、添加剂材料和配方的高科技化迈进。我们应有关厂家提出的技术要求，针对石化产品生产工艺复杂、添加剂配比要求严格、品种多样、互换性差的特点，开发研制了计算机与PLC集成控制系统。该系统控制可靠、操作简便、开放性强、性能价格比高，在国内石化系统的数家企业推广应用后，受到好评。
1　系统组成
　　计算机与PLC集成控制系统由生产系统和非生产系统二部分组成(如图1)。生产系统主要由微型机、适配器、PLC、执行机构及现场仪表等部分组成。非生产系统主要由工艺流程模拟显示屏、电视监视设备、现场通话设备、质量检查系统、管理信息系统等部分组成。中央控制室负责处理来自生产系统和非生产系统的大量信息。通过计算机与PLC集成控制系统，将润滑油厂的各生产车间、附属部门以及总厂厂部联成了密不可分的整体，从而最大限度地利用了信息资源。

图1  计算机集成控制系统的组成
2　系统功能
　　为满足用户提出的技术要求和现场的工况，此控制系统的设计具有以下功能：
　　1.根据用户提出的技术要求，按照添加剂配方的比例精确地配制生产各种型号的石化产品，并且通过微型机和现场PLC控制系统实现整个生产过程的自动化。
　　2.通过自行开发的计算机软件，实现生产现场的动态监控。良好的人机界面、清晰的组态图形，使得操作人员通过计算机屏幕，对于现场的各种工况变化一目了然。
　　3.在现场生产中，为提高整个控制系统的精确性，在搅拌器、电动机、电动阀、电磁阀等设备上均设计了局部反馈功能，这些相互独立系统的局部反馈功能构成了对总系统反馈控制的有力支持。
　　4.当系统出现压力报警或油面报警时，一方面通过PLC程序实现自动停车，另一方面借助于语音卡，在控制间的操作人员可以立即听到报警信号，及时采取相应措施。
　　5.考虑到生产现场某些部位属于高温、有害气体残留处，技术人员不宜靠近，在现场设置了电视监视设备，让技术人员实现远程监控。为便于管理，还安装了现场通话设备。
　　6.在中央控制室设置了1个大屏幕模拟显示屏，在屏幕上不仅可以显示总厂所有管道线路，而且能够动态显示油的液位、流向，让高层管理人员从宏观上掌握全厂的生产状况。
　　7.通过微机联网，质量检查部门可以直接得到工业现场的信息，各管理部门之间也可以实现数据通信与数据共享。
3　硬件与软件设计
3.1　硬件设计
　　在本系统中，工业现场控制是核心，而工业现场控制主要由PLC系统完成，所以如何合理有效地使用PLC技术就成了设计的关键。PLC的特点是控制可靠，编程简单，但程序内存不大，不能进行复杂的编程；而石化产品的特点是生产工艺复杂，产品型号繁多，往往1条生产线就能够生产几十种型号的产品。这就形成了一对矛盾。如果设计时采用常规的PLC控制系统，那么1条生产线就需要20几台PLC基本模块和A/D转换模块。投资巨大，而且按照现代控制理论，在1个控制系统中配置的控制模块越多，控制越不可靠。为了减少投资和增强控制的可靠性，在PLC控制系统的硬件配置上进行了多项创新。
　　以润滑油生产线为例，在润滑油生产车间，有搅拌温度、添加剂温度、输油泵压力、油罐的液面等共计32路模拟信号需要检测。如果按常规设计，需要8块FX-4AD模块。为减少投资，设计了多路开关切换电路，只用2块FX-4AD模块就完成了全部功能。图2为FX-4AD模块的多路开关切换示意图。


图2　FX-4AD模块的多路开关切换示意图
　　图2中，FX-4AD模块为12位4通道模拟量输入模块，Y0、Y1、Y2、Y3为PLC的任意输出触点。FX-4AD模块的多路开关切换电路的设计实质上是通过1个多路开关控制FX-4AD模块分别去完成搅拌温度检测、添加剂温度检测、输油泵压力检测及油罐液面检测4项功能，其中多路开关的4个转换触点接PLC的输出触点，由PLC编程控制。这个多路开关切换电路简单实用，而且节省了大量投资，实践证明，该电路在控制精度上完全满足用户的需要。
3.2　软件设计
　　在计算机与PLC集成控制系统的软件设计中，也采用了许多新的设计思想。
　　仍以润滑油生产车间为例，按照用户提出的72种润滑油的生产工艺和技术要求，如果用常规方法编程，需要12台PLC基本模块。为节约投资，我们充分利用PLC的文件寄存器(2000点)，用逐项查表的方法编写了1个72种润滑油的通用程序，用1台PLC基本模块带2台PLC扩展模块的方式完成了过去需要12台PLC才能实现的功能。
　　我们选用了三菱公司生产的FX系列的可编程序控制器，文件寄存器共计2 000点(D1000～D2999)。为节约程序内存，充分利用PLC本身提供的指令资源，我们选用了字传送方式，用1个16bit的字来控制PLC触点的16个输出触点，而不必像过去那样，1条指令只能控制1个输出触点。例如在图3中，首先X0导通，十进制数K6送入数据寄存器D0，接着X1导通，数据寄存器D0的数值K6转化为二进制数“0000　0000　0000　0110”送入K4Y0，控制输出Y0～Y17共计16个触点的动作，其开关动作和数据寄存器D0的数值K6一一对应。如图4所示，“1”控制输出触点导通，“0”控制输出触点关断。在此例中，Y1、Y2触点导通，其余输出触点关断。 

图3  字传送方式控制输出触点示意图

图4  数据寄存器DO的值与16个触点的对应关系
　　通过字传送方式，我们用1条指令就可控制16个电动阀及输油泵的动作，大大节省了程序空间。在这种设计思想下，我们把72种润滑油的工艺流程全部用字方式编写，然后输入文件寄存器，并在此基础上，编制了72种润滑油的通用程序。在通用程序运行时，根据某一润滑油的型号，通过查表的方式，在文件寄存器中调出对应的数据段(这些数据段也就是该种润滑油的工艺流程)，然后该数据自动输入PLC的控制程序，使得PLC按照规定的工艺流程控制整个执行机构工作。如图5所示之例，润滑油品种LSO-1的工艺状态字存于文件寄存器D1050～D1060 10个字节中。程序运行时，首先根据润滑油型号在文件寄存器中寻址，查到正确的地址后，调出D1050～D1060 10个字节的数据，然后输入到通用程序的相应寄存器，参与工业控制。

图5  文件寄存器示意图
4　计算机与PLC的通信技术
　　在计算机与PLC集成控制系统中，一个关键的技术问题是计算机与PLC的通信。若在整个系统设计中全部采用进口器件，软件也选用相应的进口产品，那么，整个工程造价惊人。针对这种情况，我们自行开发了计算机与PLC的串行通信技术。该技术设计思想先进，软硬件简单实用，可靠性高，性能价格比好，兼容性强，可适用于市场上多种型号的计算机与PLC。
　　从硬件上讲，现在中国市场上使用的PLC，在通信接口上多采用RS422接口或RS485接口；而微型机多采用RS232接口。这样在计算机与PLC通信时就不可避免地要选用RS422-RS232转换模块，同时考虑到恶劣工况下的抗干扰要求，这个转换模块必须具有良好的隔离功能和放大功能，而选用高性能进口模块，必定提高工程造价。
　　针对这种情况，为降低工程造价，我们在硬件上用1根普通的通信电缆代替进口的通信模块，在电缆的接口处采用先进的电路设计技术和单片机技术，以完成信号的隔离和放大功能。实践证明，通信的可靠性完全可以和国外的进口模块媲美，而且造价极低。
　　从软件上讲，计算机和PLC的通信技术属于保密技术，长期为国外公司垄断。这就使得我们只要选用了该厂家生产的PLC，就必须选用它开发的工控软件，提高工程造价。针对这种情况，我们开发了自己的工控软件。下面以三菱公司生产的FX系列可编程序控制器为例，介绍我们的软件设计。FX系列可编程序控制器命令格式如表1所示。
表1　FX系列可编程序控制器的命令格式

命令命令号日标设备功　　　能
设备读命令‘0’X/Y/M/S/T/C/D读位设备或字设备状态
设备写命令‘1’X/Y/M/S/T/C/D写位设备或字设备
强制开命令‘7’X/Y/M/S/T/C打开位设备
强制关命令‘8’X/Y/M/S/T/C关闭位设备

　　每一个字符都以ASCII码形式串行传输，传输格式如图6。 

图6  字符传输格式
　　例如，字符‘F’(ASCII码是46H)的传输格式如图7。

图7  字符“F”的传输格式
　　一般文本数据的传输格式如图8。

图8  文件数据传输格式
　　图8中，STX为文本的开始，其ASCII码定为02H；ETX为文本的结束，其ASCII码定为03H；CMD为命令字符，取‘0’、‘1’、‘7’、‘8’。
　　在STX之后，被传送数据的ASCII之和，也被作为2个字符码发送。
　　例如，实现从地址10F6(10F6为寄存器D123的地址)处读取4个字节数据，执行传输格式如图9。
　　求和：
　　30H+31H+30H+46H+36H+30H+34H+03H
　　＝74H

图9  传输格式之例
　　通过改变命令号和地址号，就可以实现计算机与PLC之间的读、写、强制开关等基本功能，用户可以使用我们研制的通信软件，也可以在该软件基础上，根据实际情况灵活地用C语言开发自己的通信程序，这正体现了该软件的开放性特点。
5　结束语
　　计算机集成控制系统采用了先进的系统集成的设计思想，投入运行后，为企业带来了可观的经济效益和社会效益。该系统在工业现场控制方面，尤其在PLC控制方面，独树一帜，以其卓越的控制功能和良好的性能价格比，赢得了用户的广泛赞誉。
作者单位：机械部洛阳拖拉机研究所计算机室(471039)
参考文献
1　赵海.现场总线网络控制系统与领域自动化.微计算机信息，1996；15(1)
2　李瑜详.微机数据通信技术.上海：上海科学技术文献出版社，1992
(收稿日期：1998-07-10)
