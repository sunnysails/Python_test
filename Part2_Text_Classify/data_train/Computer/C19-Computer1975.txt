微型机与应用
MICROCOMPUTER & ITS APPLICATIONS
1999年 第18卷 第2期 Vol.18 No.2 1999



基于HART协议的高精度智能温度变送器研制
杨　文
　　摘　要：介绍现场总线式仪表HART协议智能温度变送器的功能特点和硬、软件的设计。
　　关键词：HART协议　温度变送器　热电偶　热电阻
　　HART(高速链路可寻址远程变换器――Highway Addressable Transducer)协议是Rosemount公司开发的一种现场通信协议，用于现场仪表与控制系统之间的数据传输。HART协议现场仪表在原有的4～20mA工业标准信号上叠加数字信号，在不中断过程信号的情况下，在同一模拟回路上同时实现通信。HART协议智能温度变送器是国家“九、五”重点科技攻关项目，它采用先进的微处理技术及全新的数字通信技术，在二线制4～20mA模拟信号上叠加数字通信信号，可以实现远距离组态、回路测试、量程标定、参数调整等功能，可以与任何符合HART协议的终端设备及上位机进行远距离通信。
1　功能及特点
1.1　传感器类型及规格组态设定
　　HART协议智能温度变送器可接受传感器类型有K、J、B、S、T、N、E等7种热电偶，PT100铂热电阻及-10～100mV信号，通过上位机或手持终端可以对传感器类型及规格进行任意组态，方便灵活。
1.2　变送器量程范围设定
　　通过上位机或手持终端对变送器参数进行任意组态，可以很方便地设定或修改变送器当前主变量量程上、下限值。
1.3　变送器回路参数调整及零点输出、满量程输出修正
　　通过上位机或手持终端可以很方便地对变送器回路参数如阻尼时间进行调整，对变送器零点输出、满量程输出进行修正。修正系数可以任意小、修正精度高、稳定性好。
1.4　自诊断/自监控功能
　　变送器定时系统零点校验、系统满量程校验，以防止零点漂移。主变量量程超限、或断偶、输出回路断开，变送器给出报警信号，上位机可监控。CPU芯片、A/D芯片、D/A芯片等主要芯片工作异常，变送器自诊断并向上位机送报警信号。
1.5　软件实现不同分度号热电偶、热电阻非线性校正功能
　　软件用差分原理，通过查表方法对不同分度号热电偶、热电阻进行非线性校正，其误差小、精度高。
1.6　变送器零点满量程可任意迁移
　　通过上位机或手持终端可以对变送器零点、满量程进行任意迁移，也可通过变送器本体的零点、量程按钮对变送器进行零点、满量程迁移，量程迁移比为40：1。
1.7　具有HART数据通信功能
　　现场变送器与控制系统之间是全数字化、双向通信系统，上位机可远程修改现场变送器仪表参数、传感器类型及传感规格组态、回路参数设定等，现场变送器可随时向上位机发送当前全部数据以供上位系统数据管理。
2　硬件设计
　　硬件框图如图1。小信号经过前置放大线路放大后，经过A/D转换使模拟信号转变成数字信号，其中A/D转换芯片采用高精度、微功耗、24位串行口通信的AD7714芯片，外围器件少、接口能力强，并具有可编程增益功能、自检验功能、系统零点、满度校验功能等。信号再经光耦隔离后，进入单片机处理系统，其中CPU采用微功耗器件AT89LV52，片内带有8KB的闪速可编程及可擦除只读存储器、256B的RAM、32条I/O线、2个16位定时器、1个五源二级的中断结构、1个双工的串行口，与MCS―51系列完全兼容。CPU完成数据处理、非线性校正、工程单位转换、量程转换，并将主要信息、主要参数、变量及单位存放在EEPROM中，同时CPU处理串行口中断的通信服务程序。信号再经D/A芯片转换成4～20mA电流输出信号，同时载有HART数字通信信号。

图1  硬件框图
3　软件设计
　　软件框图如图2。线性化处理采用1次插分原理，其公式为：
　　
　　T：当前温度值；
　　Vx：当前电压值；
　　Vn+1,Vn：分别表示n+1点、n点的电压值；
　　Tn+1,Tn：分别表示n+1点、n点的温度值。
　　主程序将被4种可能的中断源打断，这4种中断源为：
　　优先级最高：定时器1溢出――通信定时控制。
　　优先级相同：定时器0溢出――采样定时控制；
串行口中断――接收/发送1B；
外部中断0――接收/发送1帧的初始化处理。
　　程序中数据处理全部采用3B浮点数运算，其精度高、误差小。在数据采样处理程序中，CPU与AD7714通信采用主从方式。AD7714的滤波常数由下面公式计算：　　
　　
　　其中：fDATA：数据传送频率；
fIN：输入晶阵频率；
fDT：数据传送10进制频率；
TM：模式选择系数。
　　数据传送频率与A/D转换有效位、仪表功耗有直接关系，数据传送频率快，A/D转换有效位减少，仪表功耗略有增加。在保证1个控制周期采样1次，并保证A/D转换有效位及仪表功耗低的情况下， 计算出最佳数据传送频率。另外，为了防止工频干扰，数据传送频率最好是50Hz的倍数。

图2  软件框图
　　在AD7714模式寄存器中，定时选择系统零点校验模式，可以对系统零点定时修正，防止系统零点漂移。
　　HART协议智能温度变送器已通过西安仪表厂科研、样试全项目测试试验，其仪表性能优良、稳定性好、通信质量高、精度达到0.2%。
作者单位：西安仪表厂技术中心新技术开发所(710082)
(收稿日期：1998-08-24)
