自动化学报
ACTA AUTOMATICA SINICA
1997年　第23卷　第4期　Vol.23　No.4　1997



基于知识的人脑三维医学图象
自动分析显示系统
谢逢　罗立民　田雪芹　胡刚
　　摘　要　设计并实现了一个基于知识的人脑三维医学图象分析显示系统，完成了脑组织的自动分割及显示.系统包含动态模块及静态模块两部分.静态模块即人脑知识库，存贮脑内各组织形态、生理及图象灰度方面的知识.动态模块包含全局数据区、图象处理算子集和控制规则集.在知识的指导下，运用“智能光线跟踪”方法提取、显示脑内主要解剖结构.
　　关键词　人工智能、光线跟踪、图象分割显示.
KNOWLEDGE-BASED SYSTEM FOR AUTOMATIC ANALYSIS AND
DISPLAY OF BRAIN MEDICAL IMAGES
XIE FENG　 LUO LIMIN 　TIAN XUEQING
(Dept. of Biomedical Eng., Southeast University, Nanjing 210096)
HU GANG
(Microelectronics Center, Southeast University, NanJing 210096)
Abstract This paper deals with the design and implementation of a knowledge-based system to analyze the anatomical images of human brain automatically. The system consists of two part: static module and dynamic module. The static module is the brain anatomical knowledge base. The dynamic module includes:set of image processing operators. control rules and global data. The control rules implement the “knowledge-based ray-tracing algorithm ” to find the surface point of the interesting organs and display them. 

Key words artificial intelligence, ray tracing, image segmentation and display.
1　引言
　　计算机断层医学成像的各种设备(X-CT，NMR)已成为获取人体结构和功能信息的重要工具.医学图象的分析与显示技术为生理病理研究及疾病早期诊断提供强有力的手段，是实现手术计划、模拟解剖教学及多模式数据融合的关键.
　　国外于80年代初推出了实用系统，如美国的ANALYZE和加拿大的ALLEGRO等.90年代初期Atam.P.Dhawn 提出基于知识的腹部CT图象分析理解系统［1］.该类系统缺乏完备有效的知识模型和直接处理三维图象的有效方法，处理时间长，结果受人为因素的影响.本文介绍我们实现的一个基于知识的人脑三维医学图象自动分析显示系统：提出了一组特征参量用以描述人脑主要结构的解剖学特征和生理功能及成象特性，建立了完整的适于3D图象分割与显示需要的人脑知识模型；从多功能光线跟踪显示系统出发，将脑内各主要结构的知识模型和体元数据匹配，直接从体积数据中提取显示人脑主要解剖结构，从而构成一个“智能光线跟踪”系统.
2　系统概况
2.1　系统基本组成
　　系统总体结构如图1所示.


图1　系统总体结构
　　静态模块即人脑知识库，位于硬盘上.每个解剖结构的相关知识存于一个数据文件中.动态模块在程序运行时驻留内存.全局数据区包含系统状态变量、原始体积数据、中间处理结果、最终结果.图象处理算子集可以包含任何图象处理算子，如滤波、插值、边界检测等.控制规则集实现系统控制策略，将图象处理算子集中的算子按一定次序有机组合，完成某项图象处理任务；有选择地将知识库的某一部分调入内存，实现知识库的搜索策略.
2.2　处理过程
　　系统采用“多功能光线跟踪”方法［2］完成人脑三维医学图象的分析显示.系统流程如图2.


图2　系统处理流程
　　光线跟踪是一种有效的体积数据的分割、显示方法，能产生真实感很强的图象.光线与物体的求交是该方法的关键.传统的光线跟踪方法全局性的预处理必不可少，如滤波、异分辨率体积数据插值等，时间空间复杂度很高；各种光线与物体的求交运算往往只利用图象灰度信息.而在医学图象中人脑各主要结构的灰度分布范围往往相互重叠，单纯依赖灰度信息无法将它们分开.
　　我们提出“智能光线跟踪”方法对之加以改进：
　　1)将全局性的预处理局部化，纳入光线跟踪过程.先进行初步表面检测，确定表面点所处位置范围.以后所有的预处理都局限于表面点附近.
　　2)初步表面检测将综合利用知识库中的几何形态及图象灰度信息，实现光线跟踪智能化.
3　系统知识
3.1　知识模型
　　所谓知识模型是一组用于刻画脑主要结构特征的参量，有数字化的，如大小、位置坐标；非数字化的，如各结构间的相对位置关系.建立人脑知识模型的目的则是定义那些对图象分割与显示有用的特征参量，以明确获取知识的范围.本文提出的人脑知识模型［3］包含拓扑结构、几何形态位置及图象灰度生理学信息三方面信息.
　　1)拓扑结构　即脑内各组织结构间的相对位置关系.从核磁共振图象中我们可分辨出颅骨、脑膜及脑脊液、大脑髓质(主要是胼胝体)、脑室、小脑及脑干等，从外到内逐层分布，以层次关系为主，并列关系为辅，如图3所示语义树.初步表面检测较多利用拓扑关系，因为它反映了人脑结构的本质特征，不受外界因素影响.


图3　人脑解剖知识模型
　　2)几何形态位置知识　描述脑内各主要结构的形状、大小及位置.表皮、颅骨、脑脊液等呈层状分布，包围内部物质，可用球壳近似，其大小以球壳厚度表示；脑干、小脑、基底核和脑室，以包围盒近似：包围盒形状与各结构表面形状接近，包围盒尺寸反映结构大小，包围盒顶点反映结构在脑内的大致位置.受个体差异、头部在体积数据中的位置等不定因素影响，包围盒只能反映组织器官所处大致范围，加速光线跟踪.
　　3)图象灰度及生理信息　生理信息包含各组织器官的名称、类属关系、生理功能等，作为知识库检索的索引，以适应不同的应用需要.脑组织在医学图象中的灰度分布和具体成象机理密切相关，是图象分割的重要依据. 
3.2　知识表示
　　系统的静态模块以数据文件方式长期存贮人脑主要结构的解剖知识；动态模块则以框架形式表示当前待匹配结构的有关知识.
　　框架由许多反映事物特性的槽组成：框架中的属性槽可用于表示结构的几何信息和灰度信息；关系槽表示相对位置关系；控制槽表示框架的匹配操作.现以大脑皮层为例说明框架的主要结构：框架名称，最大厚度，最小厚度，平均厚度，最大灰度，最小灰度，平均灰度，父框架名称，子框架名称，兄弟框架名称，生理功能，框架匹配规则.
　　通过框架的初始化操作，将知识库中相应的数据文件调入内存，填充框架的属性槽和关系槽，完成静态知识到动态知识的转变.
3.3　知识获取
　　人脑主要结构的生理信息及拓扑关系来源于人体解剖学中对人脑构造及功能的描述；几何形态知识来源于人脑三维立体定向图谱［4］，该图谱给出了不同断面上脑内各主要结构的定量描述，如最大、最小及平均尺寸、位置等.由于这些数据建立在大量样本测量的基础上，故具有一定代表性；图象灰度信息来源于我们对人脑或二维图象的实际测量，主要通过人机交互手段实现.为了避免个体差异带来的影响，我们对几何形态及灰度信息的数字化特征参量作了归一化处理.
3.4　知识运用――基于知识的初步表面检测
　　基于知识的表面检测由一系列光线和框架的匹配操作组成，其基本思想是：从图3中寻找一条以根结点为起点，以目标结点为终点的路径.路径上的结点代表了光线到达目标之前遇到的物体.这样的路径可能有多条，代表从不同方向射入人脑的光线可能遇到不同物体.根据框架选择规则决定当前待匹配结构，并将对应数据文件从知识库调入内存，初始化对应框架.然后将光线上的体元数据与框架属性匹配，找出属于该结构的所有体元.引导光线穿过这些体元，直至到达目标结构的表面.
4　系统推理机制
　　推理是指从知识库中选取相应的知识以指导图象的分割和理解.系统推理机制的实现依赖于动态模块中的控制规则集和系统状态变量.
4.1　系统状态变量
　　系统状态变量是一个全局结构，结构中的域反映了系统当前状态.其组成可描述如下：
Type Status=Record
volume data; 原始体积数据是否被调入内存；
ray data; 　　当前光线是否初始化；
frame data;　　当前框架是否初始化；
surface find; 　是否找到光线与体表的交点；
frame match; 　　当前框架是否匹配成功；
End
　　在系统初始化时，各域都被置0.
4.2　控制规则
　　系统的控制规则以产生式表示，形式为：IF前提条件，Then 动作.前提条件即系统状态变量中的各个域；动作则是图象处理算子.系统的主要控制规则有：
　　1)初始化规则――包括体积数据初始化(将体积数据调入内存)、光线初始化(从体积数据中读出当前光线上的体元数据)和框架初始化规则.
　　2)框架选择规则――该规则决定知识库中下一待匹配的结构，即实现知识库的搜索策略.系统采用带回溯机制的深度优先算法.
　　3)框架匹配规则――框架匹配的前提是其父框架都已经匹配成功，即光线已穿过属于这些结构的体元.以大脑皮层为例，说明框架的匹配操作：若当前体元灰度值不在皮层灰度范围内，光线前进一步，计数器加1；若计数器的值已超过皮层最大厚度，则框架匹配失败，初始化下一根光线.若当前体元灰度值在皮层灰度范围内，则记下当前点位置，并对以后的n个体元进行同样的检验.若符合条件的体元数超过阈值，则认为当前点即为表面点.否则，光线从当前位置继续前进一步，计数器加1.
　　4)图象处理规则――若找到物体表面体元，则依次调用局部插值、局部边界检测、表面法线矢量计算、图象合成等图象处理算子.
5　实验结果及讨论
　　在医学应用中，从体积数据中自动提取显示给定的某个组织结构有重要意义.由于病灶情况复杂，对病变组织的自动检测往往很困难，采用“淘汰法”是解决该问题的一条有效途径：利用基于知识的系统先提取各个已知组织，并从体积图象中减去，剩下的结构往往对应于病变.本系统对若干个三维脑部CT和MR图象数据进行了实验.这里以一个256×256×196的人脑三维MR图象为例，感兴趣结构包括头部轮廓、大脑皮层、侧脑室等.给定某个结构后，系统自动提取并给出相应结构的三维显示，如图4所示.图4a-c显示为头部轮廓；d-f为大脑皮层；g-h为侧脑室.实验表明图象分析与理解的效果与知识模型密切相关：
　　1) 灰度信息对图象分割影响很大.灰度范围太宽或太窄均会导致误分割，甚至出现伪象；
　　2) 分割的效果还与视线方向有关.大脑皮层后视图及顶视图的分割显示效果明显优于正视图.由于知识模型中尚未包含眼、鼻、口腔等面部结构，这些结构只能从正视图中看到.


图4　室验结果图象
　　虽然实验结果表明，本文提出的“智能光线跟踪系统”与传统的三维图象分析和显示方法相比运算速度及自动程度大大提高，但知识库和对其的运用还有待于进一步完善.
作者简介:谢　逢　一九九五年三月于东南大学生物科学与医学工程系生物医学工程硕士，现为美国Clemson大学博士研究生.
　　罗立民　一九八六年六月于法国雷恩大学获信息处理博士，现任东南大学生物科学与医学工程系教授、博士生导师和系主任，学术兼职有IEEE Engineering on Biology and Medicine Magazine, IEEE Book Series on Emerging Technologies in Biomedical Engineering 和 Innovation Technolgie en Biologie et Medecine 编委，法国雷恩大学客座教授.他目前的研究兴趣在于三维医学图象分析与显示、三维动态图象分析、基于知识和模型的高维较象和建模和分析、显微医学图象分析和应用、立体定向外科治疗计算机计划系统. Email: luo. list@seu. edu. cn.
作者单位:谢逢　罗立民　田雪芹　东南大学生命科学与医学工程系　南京　210096
　　　　　胡刚　东南大学微电子中心　南京　210096
参考文献
［1］　Atam P.Dhawan, et al.. Knowledge-based analysis and understanding of medical images. Method & Programs in Biomedicine, 1990(33):221―239
［2］　罗立民等.多功能光线跟踪方法.东南大学学报，1994(9)：14―19
［3］　谢逢.基于知识的人脑三维医学图象的分析与显示［硕士论文］.南京：东南大学，1995，24―38.
［4］　陈玉敏等.人脑内主要核团立体定位解剖图谱.北京：科学出版社.
收稿日期　1995-05-31
